{% liquid
  case settings.offcanvas_img_orientation
    when 'square'
      assign img_width  = 600
      assign img_height = 600
    when 'landscape'
      assign img_width  = 600
      assign img_height = 480
    when 'portrait'
      assign img_width  = 480
      assign img_height = 600
  endcase
%}

{% if settings.wishlist_enable %}
<div
  id="offcanvas-wishlist"
  class="offcanvas offcanvas-end offcanvas-mobile-full {{ settings.offcanvas_opening_direction }}"
  tabindex="-1"
  aria-labelledby="offcanvas-wishlist-label">

  <div class="offcanvas-header {{ settings.offcanvas_header_bg }}">
    <h2 id="offcanvas-wishlist-label" class="offcanvas-title {{ settings.offcanvas_header_title_size }}">
      {{ 'general.wishlist.offcanvas_title' | t }}
    </h2>
    <button
      type="button"
      class="btn-close {% if settings.offcanvas_header_bg contains 'text-white' %}btn-close-white{% endif %}"
      data-bs-dismiss="offcanvas"
      aria-label="{{ 'general.accessibility.close' | t }}">
    </button>
  </div>

  <div class="offcanvas-body">
    <div id="offcanvas-wishlist-empty" class="text-muted text-center py-5" hidden>
      <svg xmlns="http://www.w3.org/2000/svg" class="opacity-75 mb-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
      {{ 'general.wishlist.empty_html' | t }}
    </div>

    <ul
      id="offcanvas-wishlist-product-listing"
      class="product-listing list-unstyled mb-6"
      hidden
      data-img-width="{{ img_width }}"
      data-img-height="{{ img_height }}"
      data-img-thumbnail="{{ settings.offcanvas_img_thumbnail }} {{ settings.offcanvas_shadow_sp }} {{ settings.offcanvas_border_color }}"
      data-show-atc-form="{{ settings.wishlist_show_atc_form }}"
      data-text-wishlist-remove="{{ 'general.wishlist.remove_from_wishlist' | t }}"
      data-text-price-regular="{{ 'product.price_regular' | t }}"
      data-text-price-from="{{ 'product.price_from' | t }}"
      data-text-price-sale="{{ 'product.price_sale' | t }}"
      data-text-add="{{ 'product.add' | t }}"
      data-text-select-variant="{{ 'product.select_variant' | t }}">
    </ul>
  </div>
</div>

<style>
/* Autoriser les clics quand l’offcanvas est ouvert (parité avec cart) */
#offcanvas-wishlist { pointer-events: none; }
#offcanvas-wishlist.show { pointer-events: auto; }
/* Aucune couche ne doit capter les clics au-dessus du contenu */
#offcanvas-wishlist::before { pointer-events: none !important; }
/* Assure la cliquabilité des liens produits */
#offcanvas-wishlist .product-listing a { position: relative; z-index: 2; pointer-events: auto; }
#offcanvas-wishlist .card, #offcanvas-wishlist li { position: relative; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const wishlistEl = document.getElementById('offcanvas-wishlist');

  // 1) Déclencheurs natifs Bootstrap (recommandé)
  document.addEventListener('click', function (e) {
    const trigger = e.target.closest('[data-bs-toggle="offcanvas"][data-bs-target="#offcanvas-wishlist"]');
    if (!trigger) return;
    e.preventDefault();
    const instance = bootstrap.Offcanvas.getOrCreateInstance(wishlistEl);
    instance.show();
  });

  // 2) Compatibilité avec anciens triggers custom [data-toggle="offcanvas-wishlist"]
  document.querySelectorAll('[data-toggle="offcanvas-wishlist"]').forEach(btn => {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      const instance = bootstrap.Offcanvas.getOrCreateInstance(wishlistEl);
      instance.show();
    });
  });

  // 3) Ne pas fermer au clic à l’intérieur
  wishlistEl?.addEventListener('click', function (e) {
    e.stopPropagation();
  });
});
</script>
{% endif %}